[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

# QR code intermediate page - must come before catch-all
# This bypasses the PWA/SPA to load a plain HTML page that stores the claim code
[[redirects]]
  from = "/qr/*"
  to = "/qr.html"
  status = 200

# Legal pages for QBO/Intuit compliance - static HTML
[[redirects]]
  from = "/privacy"
  to = "/privacy.html"
  status = 200

[[redirects]]
  from = "/terms"
  to = "/terms.html"
  status = 200

# Note: Netlify functions at /.netlify/functions/* are handled automatically
# No redirect rule needed - they work out of the box

# SPA catch-all - serves index.html for all other routes
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "20"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  external_node_modules = ["@sendgrid/mail"]

# Increase timeout for AI functions (requires Pro plan for 26s, otherwise 10s max)
[functions."analyze-recording"]
  timeout = 26

[functions."transcribe"]
  timeout = 26

[functions."expand-roadmap-idea"]
  timeout = 26

[functions."ai-product-assistant"]
  timeout = 26

[functions."qbo-validate-builders"]
  timeout = 60

[functions."qbo-import-builders"]
  timeout = 60

[functions."qbo-search-customer"]
  timeout = 60

# Optimization settings
[build.processing]
  skip_processing = false

[build.processing.css]
  bundle = true
  minify = true

[build.processing.js]
  bundle = true
  minify = true

[build.processing.html]
  pretty_urls = true

[build.processing.images]
  compress = true
